---
layout: post
title: "ifとandの私的使い分けルール"
category: Programming
tags: [Clojure]
---

Wikipeaidの[if文のページ](http://ja.wikipedia.org/wiki/If%E6%96%87)の下の方の「論理積・論理和による擬似的なif文」のところに、andやorでif文と同様なことができると書いてあります。

たしかに

```clojure
(if (odd? x)
  (println "TVの音量は偶数で！"))
```

は、

```clojure
(and (odd? x) (println "TVの音量は偶数で！"))
```

と同じ動作をしますもんね（Clojureの`and`は、内部で`if`を使っているマクロですし）。

ただし、この2つのコード、戻り値は異なっているんですよ。

`if`で条件が偽で`else`が省略されていた時は`nil`で、`and`で最初の引数が偽だった場合は最初の引数（上の例の場合は`false`）が返ります。そしてClojureでは、`nil`と`false`を異なるものとして扱う場合があります。代表として、私が大好きな`keep`関数に登場していただきましょう。

```clojure
(keep #(if (= (:programming-language %) "Clojure")
         (:name %))
      systems)
              
;; この程度だとfilterとmapで書いた方がキレイなのですけど、例なのでご容赦ください。
```

このコードでは、`if`の代わりに`and`を使うことはできません。`and`を使うと、Clojureなシステムの場合は名前を、そうでない場合は`false`を返すという無意味な処理になってしまいますもんね。

あと、`cons`や`concat`、`mapcat`のようなシーケンスを作る関数では、`nil`を要素数がゼロのシーケンスとしてみなしてくれます。もしこれらの関数に`false`を渡したら、実行時エラーになってしまいます。

つまり、`nil`は`false`よりも使い勝手がいいんですよね。偽を表現する場合にも、存在していないことを表現する場合にも、空の集合を表現する場合にも使える。

だから、結果がどのような使われ方をするか分からない関数の戻り値に関係するような場合、私は`if`を使います。そうでない場合、結果を同じ関数内で消費するような場合は、一行で書いても違和感が少ない`and`を使うようにしています。これが私のコードを書くときのルールなわけですな。

＃あと、どうしても`else`が必要な場合は、`if`を使うしかないので`if`を使っています。

そうそう。最初に挙げたTVの音量の場合はどちらにするかといえば、`println`という処理をするかどうかの判断なので、処理のための分岐であることが明確になるように、私なら`when`を使います。
